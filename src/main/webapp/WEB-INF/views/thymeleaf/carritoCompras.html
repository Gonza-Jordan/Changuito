<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Carrito de Compras</title>
    <link rel="stylesheet" type="text/css" href="/spring/css/main.css">
</head>
<body>
<header th:include="header.html" class="cabecera"></header>

<div class="carrito-container">
    <h1 class="carrito-title">Tu Carrito de Compras</h1>
    <div class="cantidad-productos">
        <p class="cantidad-texto" th:text="'Cantidad de productos en el carrito: ' + ${cantidadProductos}">Cantidad de productos en el carrito: 0</p>
    </div>
    <table class="carrito-table">
        <thead>
        <tr>
            <th>Foto</th> <!-- columna de la foto, actualmente vacía -->
            <th>Producto</th>
            <th>Precio Unitario</th>
            <th>Cantidad</th>
            <th>Categoría</th>
            <th>Subcategoría</th>
            <th>Acciones</th>
            <th>Precio producto total</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="producto, row : ${carrito}">
            <td><!-- Columna vacía para futura imagen --></td>
            <td th:text="${producto.nombre}">Nombre del Producto</td>
            <td>
                <span class="precio-unitario" th:text="${producto.precio}">Precio</span>
            </td>
            <td>
                <select class="cantidad-select">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </td>
            <td th:text="${producto.categoria}">Categoría</td>
            <td th:text="${producto.subcategoria}">Subcategoría</td>
            <td>
                <form action="/eliminar-del-carrito" method="post">
                    <input type="hidden" name="codigoBarras" th:value="${producto.codigoBarras}">
                    <button type="submit">Eliminar</button>
                </form>
            </td>
            <td>
                <span class="precio-total" th:text="${producto.precio}">Precio Total</span>
            </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="6"></td>
            <td style="text-align: right;">Total:</td>
            <td id="total-final" colspan="2">0.00</td>
        </tr>
        </tfoot>
    </table>
</div>

<footer th:include="footer.html"></footer>

<script type="text/javascript" src="/spring/js/main.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var cantidadSelects = document.querySelectorAll('.cantidad-select');
        cantidadSelects.forEach(function(select) {
            select.addEventListener('change', function() {
                var row = this.closest('tr');
                var precioUnitario = parseFloat(row.querySelector('.precio-unitario').innerText);
                var cantidad = parseInt(this.value);
                var precioTotal = precioUnitario * cantidad;
                row.querySelector('.precio-total').innerText = precioTotal.toFixed(2);
                actualizarTotal();
            });
        });
    });

    function actualizarTotal() {
        var total = 0;
        var precios = document.querySelectorAll('.precio-total');
        precios.forEach(function(precio) {
            total += parseFloat(precio.innerText);
        });
        document.getElementById('total-final').innerText = total.toFixed(2);
    }
</script>
</body>
</html>
